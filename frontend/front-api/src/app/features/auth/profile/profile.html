<div class="container py-5">

  <h2 class="text-dark-blue fw-bold mb-4">Mi Perfil</h2>

  <!-- INFO USUARIO -->
  <div class="card shadow-sm mb-4 rounded-4">
    <div class="card-body">
      <h5 class="card-title text-dark-blue fw-bold mb-3">Información del usuario</h5>

      <div class="row g-3">
        <div class="col-md-4">
          <label class="form-label">Nombre</label>
          <input type="text" class="form-control" [value]="user.nombre" disabled>
        </div>

        <div class="col-md-4">
          <label class="form-label">Apellido</label>
          <input type="text" class="form-control" [value]="user.apellido" disabled>
        </div>

        <div class="col-md-4">
          <label class="form-label">Correo</label>
          <input type="email" class="form-control" [value]="user.correo" disabled>
        </div>
      </div>
    </div>
  </div>

  <!-- DIRECCIONES -->
  <div class="card shadow-sm mb-4 rounded-4">
    <div class="card-body">
      <h5 class="card-title text-dark-blue fw-bold mb-3">Mis Direcciones</h5>

      <table class="table table-hover" *ngIf="(direcciones ?? []).length > 0">
        <thead>
          <tr>
            <th>Calle</th>
            <th>Ciudad</th>
            <th>Departamento</th>
            <th>País</th>
            <th>Teléfono</th>
            <th style="width: 150px;">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let d of direcciones; let i = index">
            <td>{{ d.calle }}</td>
            <td>{{ d.ciudad }}</td>
            <td>{{ d.departamento }}</td>
            <td>{{ d.pais }}</td>
            <td>{{ d.telefono }}</td>
            <td class="d-flex gap-2">
              <button class="btn btn-outline-primary btn-sm" (click)="editarDireccion(i)">
                Editar
              </button>
              <button class="btn btn-outline-danger btn-sm" (click)="eliminarDireccion(i)">
                Eliminar
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <p *ngIf="direcciones?.length === 0" class="text-muted">
        No tienes direcciones guardadas.
      </p>

      <hr>

      <!-- FORMULARIO -->
      <h6 class="fw-bold mb-3">
        {{ editIndex !== null ? 'Editar Dirección' : 'Agregar nueva dirección' }}
      </h6>

      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">Calle *</label>
          <input class="form-control" [(ngModel)]="nuevaDireccion.calle" required>
        </div>

        <div class="col-md-6">
          <label class="form-label">Ciudad *</label>
          <input class="form-control" [(ngModel)]="nuevaDireccion.ciudad" required>
        </div>

        <div class="col-md-6">
          <label class="form-label">Departamento</label>
          <input class="form-control" [(ngModel)]="nuevaDireccion.departamento">
        </div>

        <div class="col-md-6">
          <label class="form-label">Código Postal</label>
          <input class="form-control" [(ngModel)]="nuevaDireccion.codigoPostal">
        </div>

        <div class="col-md-6">
          <label class="form-label">País</label>
          <input class="form-control" [(ngModel)]="nuevaDireccion.pais">
        </div>

        <div class="col-md-6">
          <label class="form-label">Teléfono</label>
          <input class="form-control" [(ngModel)]="nuevaDireccion.telefono">
        </div>
      </div>

      <div class="d-flex gap-2 mt-3">
        <button class="btn btn-primary w-100" (click)="agregarDireccion()">
          {{ editIndex !== null ? 'Guardar Cambios' : 'Agregar Dirección' }}
        </button>

        <button *ngIf="editIndex !== null"
                class="btn btn-secondary w-50"
                (click)="resetForm()">
          Cancelar
        </button>
      </div>

    </div>
  </div>

  <!-- MÉTODOS DE PAGO -->
<div class="card shadow-sm mb-4 rounded-4">
  <div class="card-body">
    <h5 class="card-title text-dark-blue fw-bold mb-3">Mis Métodos de Pago</h5>

    <table class="table table-hover" *ngIf="(metodosPago ?? []).length > 0">
      <thead>
        <tr>
          <th>Titular</th>
          <th>Tarjeta</th>
          <th>Expira</th>
          <th style="width: 120px;">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let m of metodosPago">
          <td>{{ m.banco }}</td>
          <td>{{ m.numeroToken}}</td>
          <td>{{ m.fechaExpiracion }}</td>

          <td>
            <button class="btn btn-outline-danger btn-sm" (click)="eliminarMetodoPago(m.id)">
              Eliminar
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <p *ngIf="metodosPago?.length === 0" class="text-muted">
      No tienes métodos de pago guardados.
    </p>

    <hr>

    <!-- FORM AGREGAR -->
    <h6 class="fw-bold mb-3">Agregar método de pago</h6>

    <div class="row g-3">
      <div class="col-md-6">
        <label class="form-label">Nombre del Banco *</label>
        <input class="form-control" [(ngModel)]="nuevoMetodoPago.nombreTitular">
      </div>

      <div class="col-md-6">
        <label class="form-label">Número de Tarjeta *</label>
        <input class="form-control" [(ngModel)]="nuevoMetodoPago.numeroTarjeta">
      </div>

      <div class="col-md-4">
        <label class="form-label">Mes Exp.</label>
        <input class="form-control" [(ngModel)]="nuevoMetodoPago.mesExp" type="number">
      </div>

      <div class="col-md-4">
        <label class="form-label">Año Exp.</label>
        <input class="form-control" [(ngModel)]="nuevoMetodoPago.anioExp" type="number">
      </div>

      <div class="col-md-4">
        <label class="form-label">CVV</label>
        <input class="form-control" [(ngModel)]="nuevoMetodoPago.cvv" type="number">
      </div>
    </div>

    <button class="btn btn-primary w-100 mt-3" (click)="agregarMetodoPago()">
      Guardar Método
    </button>

  </div>
</div>

  <!-- PEDIDOS -->
  <div class="card shadow-sm rounded-4">
    <div class="card-body">
      <h5 class="card-title text-dark-blue fw-bold mb-3">Mis Pedidos</h5>

      <table class="table table-hover" *ngIf="(pedidos ?? []).length > 0">
        <thead>
          <tr>
            <th># Pedido</th>
            <th>Fecha</th>
            <th>Total</th>
            <th>Estado</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let p of pedidos">
            <td>{{ p.id }}</td>
            <td>{{ p.fecha }}</td>
            <td>Q. {{ p.total }}</td>
            <td>{{ p.estado }}</td>
          </tr>
        </tbody>
      </table>

      <p *ngIf="pedidos?.length === 0" class="text-muted">
        No tienes pedidos registrados.
      </p>
    </div>
  </div>

  <button class="btn btn-primary w-100 mt-3" routerLink="/home">
    Volver a Inicio
  </button>
</div>
